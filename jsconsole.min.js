!function(e,t){function n(){this.el=i("span","cursor")}function i(e,n){var i=t.createElement(e);return n&&(i.className=h+n),i}function r(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function s(e){o(e)&&r(e)}function o(e){return e&&(3===e.nodeType||e.className===h+"char")}function l(e,r){if(r=r||{},this.el="string"==typeof e?t.getElementById(e):e,this.cursor=new n,this._stop=null,this.container=null,this.lines=[],this.prompt=null,this.listeners={},this.commands=r.commands||{},this.fullScreen=!!r.fullScreen,this.transform=r.transform,!("prompt"in r)||r.prompt){var s=i("span","prompt");s.appendChild(t.createTextNode(r.prompt||"$ ")),this.prompt=s}this.render()}var h="jsconsole-";n.prototype={writeChar:function(e,n){var r;n&&(r=i("span","char"),r.style.color=n);var s=t.createTextNode(e);r?r.appendChild(s):r=s,this.el.parentNode.insertBefore(r,this.el)},del:function(){s(this.el.nextSibling)},backspace:function(){s(this.el.previousSibling)},moveToWord:function(e){var t=this.el[e+"Sibling"],n=null;do{if(!o(t))break;if(" "===t.nodeValue){if(n)break}else n="next"===e?t.nextSibling:t}while(t=t[e+"Sibling"]);(n||"next"===e)&&this.el.parentNode.insertBefore(this.el,n)},moveToChar:function(e){var t=this.el[e+"Sibling"];o(t)&&("next"===e&&(t=t.nextSibling),this.el.parentNode.insertBefore(this.el,t))},prevChar:function(){this.moveToChar("previous")},prevWord:function(){this.moveToWord("previous")},nextChar:function(){this.moveToChar("next")},nextWord:function(){this.moveToWord("next")},beginning:function(){this.el.parentNode.insertBefore(this.el,this.el.parentNode.firstChild)},end:function(){this.el.parentNode.insertBefore(this.el,null)}},l.prototype={render:function(){this.container=i("div","container"),this.fullScreen&&this.toggleFullScreen(!0),this.newLine(),this.el.appendChild(this.container)},write:function(e,t){if(this.transform){var n=this.transform(e,t);e=n.text,t=n.color}for(var i=0;i<e.length;i++)this.cursor.writeChar(e.charAt(i),t);this.scrollToCursor(),this.emit("write",e,t)},clear:function(){for(var e=0;e<this.lines.length;e++)this.lines[e].el.parentNode.removeChild(this.lines[e].el);this.lines=[],this.newLine()},toggleFullScreen:function(e){var t=this.container.className,n=h+"fullscreen",i=new RegExp("\\b"+n+"\\b");this.container.className="undefined"!=typeof e?e?t+=" "+n:t.replace(i,""):i.test(t)?t.replace(i,""):t+=" "+n},scrollToCursor:function(){this.container.scrollTop=this.container.scrollHeight},newLine:function(){var e=i("div","line");this.prompt&&e.appendChild(this.prompt.cloneNode(!0));var t=i("span","command-area");t.appendChild(this.cursor.el),e.appendChild(t),this.container.appendChild(e),this.lines.push({el:e,command:t}),this.scrollToCursor()},getCurrentText:function(){return[].slice.call(this.lines.slice(-1)[0].command.childNodes).filter(o).map(function(e){return 3===e.nodeType?e.nodeValue:e.firstChild.nodeValue}).join("")},execute:function(){var e=this.getCurrentText(),t=e.split(" ")[0],n=e.substring(t.length+1).trim(),i=this.commands[t]||this.commands["no command"],r=this;t&&i?i.call(this,t,n,function(e,i){i=i||{},e&&r.write("\n"+e),i.noNewLine||r.newLine(),r.emit("execute",t,n)}):this.newLine()},handleKeyUp:function(e){var t=e.keyCode,n={8:1,13:1,35:1,36:1,37:1,39:1,46:1};n[t]&&this.handleKeyCode(e)},handleKeyPress:function(e){var t={8:1};return t[e.keyCode]?(e.preventDefault(),void 0):(e.charCode&&this.handleKeyCode(e),void 0)},handleKeyCode:function(e){function t(){return e.preventDefault(),!0}var n=e.charCode,i=e.altKey,r=e.ctrlKey;if(!i){if(n){if(e.metaKey)return;if(r&&(67===n||99===n))return t(),this.write("^C"),this.newLine(),void 0;if(r)return;return n>=32&&126>=n&&(t(),this.write(String.fromCharCode(n))),void 0}switch(e.keyCode){case 13:return t()&&this.execute(),void 0;case 8:return t()&&this.cursor.backspace(),void 0;case 46:return t()&&this.cursor.del(),void 0;case 37:return t()&&this.cursor["prev"+(r?"Word":"Char")](),void 0;case 39:return t()&&this.cursor["next"+(r?"Word":"Char")](),void 0;case 36:return t()&&this.cursor.beginning(),void 0;case 35:return t()&&this.cursor.end(),void 0}}},start:function(e){e=e||t;var n=this.handleKeyPress.bind(this),i=this.handleKeyUp.bind(this);e.addEventListener("keypress",n,!1),e.addEventListener("keyup",i,!1),this._stop=function(){e.removeEventListener("keypress",n,!1),e.removeEventListener("keyup",i,!1)}},stop:function(){this._stop&&this._stop()},on:function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},emit:function(e){for(var t=this.listeners[e]||[],n=[].slice.call(arguments,1),i=0;i<t.length;i++)t[i].apply(this,n)}},e.JSConsole=l}(window,document);