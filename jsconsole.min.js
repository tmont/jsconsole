!function(e,t){function i(){this.el=n("span","cursor")}function n(e,i){var n=t.createElement(e);return i&&(n.className="jsconsole-"+i),n}function s(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function r(e){o(e)&&s(e)}function o(e){return e&&3===e.nodeType}function h(e,s){if(s=s||{},this.el="string"==typeof e?t.getElementById(e):e,this.cursor=new i,this._stop=null,this.container=null,this.lines=[],this.prompt=null,this.listeners={},this.height=s.height,this.commands=s.commands||{},!("prompt"in s)||s.prompt){var r=n("span","prompt");r.appendChild(t.createTextNode(s.prompt||"$ ")),this.prompt=r}this.render()}i.prototype={writeChar:function(e){var i=t.createTextNode(e);this.el.parentNode.insertBefore(i,this.el)},del:function(){r(this.el.nextSibling)},backspace:function(){r(this.el.previousSibling)},moveToWord:function(e){var t=this.el[e+"Sibling"],i=null;do{if(!o(t))break;if(" "===t.nodeValue){if(i)break}else i="next"===e?t.nextSibling:t}while(t=t[e+"Sibling"]);(i||"next"===e)&&this.el.parentNode.insertBefore(this.el,i)},moveToChar:function(e){var t=this.el[e+"Sibling"];o(t)&&("next"===e&&(t=t.nextSibling),this.el.parentNode.insertBefore(this.el,t))},prevChar:function(){this.moveToChar("previous")},prevWord:function(){this.moveToWord("previous")},nextChar:function(){this.moveToChar("next")},nextWord:function(){this.moveToWord("next")},beginning:function(){this.el.parentNode.insertBefore(this.el,this.el.parentNode.firstChild)},end:function(){this.el.parentNode.insertBefore(this.el,null)}},h.prototype={render:function(){this.container=n("div","container"),this.height&&(this.container.style.height="number"==typeof this.height?this.height+"px":this.height),this.newLine(),this.el.appendChild(this.container)},write:function(e){for(var t=0;t<e.length;t++)this.cursor.writeChar(e.charAt(t));this.scrollToCursor(),this.emit("write",e)},clear:function(){for(var e=0;e<this.lines.length;e++)this.lines[e].el.parentNode.removeChild(this.lines[e].el);this.lines=[],this.newLine()},scrollToCursor:function(){this.container.scrollTop=this.container.scrollHeight},newLine:function(){var e=n("div","line");this.prompt&&e.appendChild(this.prompt.cloneNode(!0));var t=n("span","command-area");t.appendChild(this.cursor.el),e.appendChild(t),this.container.appendChild(e),this.lines.push({el:e,command:t}),this.scrollToCursor()},getCurrentText:function(){return[].slice.call(this.lines.slice(-1)[0].command.childNodes).filter(o).map(function(e){return e.nodeValue}).join("")},execute:function(){var e=this.getCurrentText(),t=e.split(" ")[0],i=e.substring(t.length+1).trim(),n=this.commands[t]||this.commands["no command"],s=this;t&&n?n.call(this,t,i,function(e,n){n=n||{},e&&s.write("\n"+e),n.noNewLine||s.newLine(),s.emit("execute",t,i)}):this.newLine()},handleKeyUp:function(e){console.log("keyup: %d",e.keyCode)},handleKeyDown:function(e){console.log("keydown: %d",e.keyCode)},handleKeyPress:function(e){function t(){return e.preventDefault(),!0}if(console.log("keypress: %d %d ctrl: %b, alt: %b, shift: %b",e.charCode,e.keyCode,e.ctrlKey,e.altKey,e.shiftKey),!e.altKey)if(e.keyCode)switch(e.keyCode){case 13:t()&&this.execute();break;case 8:t()&&this.cursor.backspace();break;case 46:t()&&this.cursor.del();break;case 37:t()&&this.cursor["prev"+(e.ctrlKey?"Word":"Char")]();break;case 39:t()&&this.cursor["next"+(e.ctrlKey?"Word":"Char")]();break;case 36:t()&&this.cursor.beginning();break;case 35:t()&&this.cursor.end()}else if(!e.altKey&&!e.metaKey)return!e.ctrlKey||67!==e.charCode&&99!==e.charCode?(e.ctrlKey||e.charCode>=32&&e.charCode<=126&&(t(),this.write(String.fromCharCode(e.charCode))),void 0):(t(),this.write("^C"),this.newLine(),void 0)},start:function(e){e=e||t;var i=this.handleKeyPress.bind(this);e.addEventListener("keypress",i,!1),this._stop=function(){e.removeEventListener("keypress",i,!1)}},stop:function(){this._stop&&this._stop()},on:function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},emit:function(e){for(var t=this.listeners[e]||[],i=[].slice.call(arguments,1),n=0;n<t.length;n++)t[n].apply(this,i)}},e.JSConsole=h}(window,document);