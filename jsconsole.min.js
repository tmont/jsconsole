!function(e,t){function i(){this.el=n("span","cursor")}function n(e,i){var n=t.createElement(e);return i&&(n.className="jsconsole-"+i),n}function r(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function s(e){o(e)&&r(e)}function o(e){return e&&3===e.nodeType}function h(e,r){if(r=r||{},this.el="string"==typeof e?t.getElementById(e):e,this.cursor=new i,this._stop=null,this.container=null,this.lines=[],this.prompt=null,this.listeners={},this.height=r.height,this.commands=r.commands||{},!("prompt"in r)||r.prompt){var s=n("span","prompt");s.appendChild(t.createTextNode(r.prompt||"$ ")),this.prompt=s}this.render()}i.prototype={writeChar:function(e){var i=t.createTextNode(e);this.el.parentNode.insertBefore(i,this.el)},del:function(){s(this.el.nextSibling)},backspace:function(){s(this.el.previousSibling)},moveToWord:function(e){var t=this.el[e+"Sibling"],i=null;do{if(!o(t))break;if(" "===t.nodeValue){if(i)break}else i="next"===e?t.nextSibling:t}while(t=t[e+"Sibling"]);(i||"next"===e)&&this.el.parentNode.insertBefore(this.el,i)},moveToChar:function(e){var t=this.el[e+"Sibling"];o(t)&&("next"===e&&(t=t.nextSibling),this.el.parentNode.insertBefore(this.el,t))},prevChar:function(){this.moveToChar("previous")},prevWord:function(){this.moveToWord("previous")},nextChar:function(){this.moveToChar("next")},nextWord:function(){this.moveToWord("next")},beginning:function(){this.el.parentNode.insertBefore(this.el,this.el.parentNode.firstChild)},end:function(){this.el.parentNode.insertBefore(this.el,null)}},h.prototype={render:function(){this.container=n("div","container"),this.height&&(this.container.style.height="number"==typeof this.height?this.height+"px":this.height),this.newLine(),this.el.appendChild(this.container)},write:function(e){for(var t=0;t<e.length;t++)this.cursor.writeChar(e.charAt(t));this.scrollToCursor(),this.emit("write",e)},clear:function(){for(var e=0;e<this.lines.length;e++)this.lines[e].el.parentNode.removeChild(this.lines[e].el);this.lines=[],this.newLine()},scrollToCursor:function(){this.container.scrollTop=this.container.scrollHeight},newLine:function(){var e=n("div","line");this.prompt&&e.appendChild(this.prompt.cloneNode(!0));var t=n("span","command-area");t.appendChild(this.cursor.el),e.appendChild(t),this.container.appendChild(e),this.lines.push({el:e,command:t}),this.scrollToCursor()},getCurrentText:function(){return[].slice.call(this.lines.slice(-1)[0].command.childNodes).filter(o).map(function(e){return e.nodeValue}).join("")},execute:function(){var e=this.getCurrentText(),t=e.split(" ")[0],i=e.substring(t.length+1).trim(),n=this.commands[t]||this.commands["no command"],r=this;t&&n?n.call(this,t,i,function(e,n){n=n||{},e&&r.write("\n"+e),n.noNewLine||r.newLine(),r.emit("execute",t,i)}):this.newLine()},handleKeyUp:function(e){var t=e.keyCode,i={8:1,13:1,35:1,36:1,37:1,39:1,46:1};i[t]&&this.handleKeyCode(e)},handleKeyPress:function(e){var t={8:1};return t[e.keyCode]?(e.preventDefault(),void 0):(e.charCode&&this.handleKeyCode(e),void 0)},handleKeyCode:function(e){function t(){return e.preventDefault(),!0}var i=e.charCode,n=e.altKey,r=e.ctrlKey;if(!n){if(i){if(e.metaKey)return;if(r&&(67===i||99===i))return t(),this.write("^C"),this.newLine(),void 0;if(r)return;return i>=32&&126>=i&&(t(),this.write(String.fromCharCode(i))),void 0}switch(e.keyCode){case 13:return t()&&this.execute(),void 0;case 8:return t()&&this.cursor.backspace(),void 0;case 46:return t()&&this.cursor.del(),void 0;case 37:return t()&&this.cursor["prev"+(r?"Word":"Char")](),void 0;case 39:return t()&&this.cursor["next"+(r?"Word":"Char")](),void 0;case 36:return t()&&this.cursor.beginning(),void 0;case 35:return t()&&this.cursor.end(),void 0}}},start:function(e){e=e||t;var i=this.handleKeyPress.bind(this),n=this.handleKeyUp.bind(this);e.addEventListener("keypress",i,!1),e.addEventListener("keyup",n,!1),this._stop=function(){e.removeEventListener("keypress",i,!1),e.removeEventListener("keyup",n,!1)}},stop:function(){this._stop&&this._stop()},on:function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},emit:function(e){for(var t=this.listeners[e]||[],i=[].slice.call(arguments,1),n=0;n<t.length;n++)t[n].apply(this,i)}},e.JSConsole=h}(window,document);